# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных:

-Интерфейс для данных каточки товара (в таком виде данные приходят с сервера).

```
export interface ICard {
  id: string;
  description: string;
  image: string;
  title: string;
  category: string;
  price: number; 
}
```

-Интерфейс для модели данных карточек(товаров).

```
export interface ICardsData {
  _cards: ICard[];
}
```

-Интерфейс для модели данных корзины.

```
export interface IBasketModel {
  items: ICard[];
  add(item: ICard): void
  remove(id: string): void;
  clear(): void;
  getTotal(): number;
  getTotalPrice(): number;
  getIds(): string[];
}
```

-Тип данных метода оплаты.

```
export type TPaymentMethod = 'online' | 'cash';
```

-Интерфейс для модели данных заказа(в формате в котором сервер принимает заказ).

```
export interface IOrderDetails {
    payment: TPaymentMethod;
    email: string;
    phone: string;
    address: string;
    total: number;
    items: string[];
}
```

-Интерфейс для отображения главной страницы.

```
interface IPage {
	counter: number;
	catalog: HTMLElement[];
	basket: HTMLElement;
	locked: boolean;
}
```

-Интерфейс для отображения модалки.

```
interface IModal {
	content: HTMLElement;
	closeButton: HTMLButtonElement;
}
```

-Базовый интерфейс отображения элементов внутри модалки.

```
export interface IView {
    render(data?: object): HTMLElement;
}
```

## Архитектура приложения
Код приложения разделен на слои согласно парадигме MVP:
- слой данных(Model), отвечает за хранение и изменение данных.
- слой представления(View), отвечает за отображение данных на странице.
- презентер(Presenter), отвечает за связь представления и данных.

### Базовый код

#### Класс Api
Содержит базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.

Методы: 
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс LarekApi
Наследует класс Api и отвечает за работу апи непосредственно нашего приложения.

Методы:
- getCards(): Promise<ApiListResponse<ICard>> - запрашивает и возвращает с сервера массив товаров в формате ICard и их количество.
- createOrder(orderDetails: IOrderDetails): Promise<object> - отправляет на сервер заказ (объект в формате IOrderDetails)

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий. 

Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие    

### Слой данных

#### Класс CardsData
Реализует интерфейс ICardsData.
Отвечает за хранение и логику работы с данными карточек(товаров) загруженных с сервера.\
Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:
- _cards: ICard[] - массив объектов карточек.
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Методы:
- getCard(id: string): ICard - возвращает карточку по ее id
- сеттер и геттер для сохранения и получения массива _cards

#### Класс BasketModel
Реализует интерфейс IBasketModel.
Класс отвечает за хранение и логику работы с товарами в корзине.
Конструктор класса принимает инстант брокера событий.

В полях класса хранятся следующие данные:
- items: ICard[] - Хранит товары и их порядковые номера.
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Методы:
- add(item: ICard): void - Добавляет товар в корзину и присваивает ему порядковый номер.
Вызывает _changed() для уведомления об изменении корзины.
- remove(id: string): void - Удаляет товар из корзины.
Вызывает _changed() для уведомления об изменении корзины.
- clear(): void - удаляет все товары из корзины.
Вызывает _changed() для уведомления об изменении корзины.
- getTotal(): number - Возвращает количество товаров в корзине.
- getTotalPrice(): number - Возвращает общую цену.
- getIds(): string[] - возвращает массив с айди товаров, для передачи в модель заказа.
- _changed(): void - Защищенный метод, который инициирует событие 'basket:changed', передавая текущие товары корзины.

#### Класс OrderDetails
Класс отвечает за хранение и заполнение, объекта с данными заказа.

В полях класса хранятся следующие данные:
- orderDetails: IOrderDetails - Хранит даные заказа.
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Методы:
- набор сеттеров для заполнения значений объекта заказа 
- get order() - возвращает заполненный объект заказа для дальнейшей отправки на сервер

### Слой отображения

#### Класс PageView
Отображение главной страницы. Реализует интерфейс IPage.
Конструктор класса принимает инстант брокера событий и (container: HTMLElement) для определения в нем нужных элементов.
На элемент корзины устанавливается обработчик клика вызывающий событие 'basket:open'.

В полях класса хранятся следующие данные:
- _counter: HTMLElement - количество товаров в корзине.
- _gallery: HTMLElement - каталог товаров.
- _wrapper: HTMLElement - обертка страницы (для блокировки прокрутки при открытом попапе).
- _basket: HTMLElement - элемент корзины.
- events: IEvents - экземпляр, реализующий интерфейс IEvents, используемый для управления событиями страницы.

Методы:
- set counter(value: number) - Устанавливает значение счетчика корзины.
- set catalog(items: HTMLElement[]) - Устанавливает каталог товаров, заменяя текущее содержимое элемента _gallery на новый массив.
- set locked(value: boolean) - Блокирует страницу, добавляя или удаляя класс page__wrapper_locked из элемента _wrapper.

#### Класс ModalView
Единое модальное окно в которое вставляется любое необходимое содержимое.
Реализует интерфейс IModal.
Конструктор класса принимает инстант брокера событий и (container: HTMLElement) для определения в нем нужных элементов.

В полях класса хранятся следующие данные:
- _closeButton: HTMLButtonElement - кнопка закрытия модального окна
- _content: HTMLElement - контейнер для содержимого модального окна
- events: IEvents - Экземпляр, реализующий интерфейс IEvents, используемый для управления событиями модального окна

Методы:
- set content(value: HTMLElement) - Устанавливает новое содержимое модального окна, заменяя текущее содержимое.
- open() - Добавляет класс modal_active к контейнеру, чтобы показать модальное окно.
- close() - Удаляет класс modal_active из контейнера, чтобы скрыть модальное окно.
Очищает содержимое модального окна.

#### Класс СatalogCardVeiw 
Карточка в каталоге. Реализует интерфейс IView.
Конструктор класса принимает инстант брокера событий и (container: HTMLElement) для определения в нем нужных элементов.
На карточку уснанавливается слушатель клика инициирующий событие ('product:selected') передавая данные товара.

В полях класса хранятся следующие данные:
- events: IEvents - экземпляр, реализующий интерфейс IEvents, используемый для управления событиями страницы.
- cardData: ICard - объект с данными карточки товара.
- category: HTMLSpanElement - категория товара.
- title: HTMLElement - название товара.
- image: HTMLImageElement - изображение товара.
- price: HTMLSpanElement - цена товара.

Методы:
- render(data: ICard): HTMLElement - сохраняет данные в поле cardData, заполняет разметку и возвращает готовую карточку.

#### Класс CardPreviewVeiw
Предпросмотр товара. Реализует интерфейс IView.
Конструктор класса принимает инстант брокера событий и (container: HTMLElement) для определения в нем нужных элементов.
На кнопку добавления товара уснанавливается слушатель клика инициирующий событие ('product:add') передавая данные товара.

В полях класса хранятся следующие данные:
- events: IEvents - экземпляр, реализующий интерфейс IEvents, используемый для управления событиями страницы.
- cardData: ICard - объект с данными карточки товара.
- category: HTMLSpanElement - категория товара.
- title: HTMLElement - название товара.
- image: HTMLImageElement - изображение товара.
- price: HTMLSpanElement - цена товара.
- info: HTMLElement - информация о товаре.
- addToCartButton: HTMLButtonElement - Кнопка добавления в корзину.

Методы:
- render(data: ICard): HTMLElement - сохраняет данные в поле cardData, заполняет разметку и возвращает готовый элемент.

#### Класс BasketView
Отображение корзины. Реализует интерфейс IView.
Конструктор класса принимает инстант брокера событий и (container: HTMLElement) для определения в нем нужных элементов.
На кнопку оформления заказа уснанавливается слушатель клика инициирующий событие ('goto:payment').

В полях класса хранятся следующие данные:
- events: IEvents - экземпляр, реализующий интерфейс IEvents, используемый для управления событиями страницы.
- productsList: HTMLUListElement - список товаров.
- totalPrice: HTMLSpanElement - общая цена заказа.
- submitOrder: HTMLButtonElement - Кнопка оформления заказа.

Методы:
- render(data: {items: HTMLElement[], price: number}): HTMLElement - заполняет разметку и возвращает готовый элемент.

#### Класс BasketItemView
Отображение товара в корзине. Реализует интерфейс IView.
Конструктор класса принимает инстант брокера событий и (container: HTMLElement) для определения в нем нужных элементов.
На кнопку удаления заказа уснанавливается слушатель клика инициирующий событие ('basketItem:delete') передавая id товара.

В полях класса хранятся следующие данные:
- events: IEvents - экземпляр, реализующий интерфейс IEvents, используемый для управления событиями страницы.
- id: string - айди товара для передачи при событии
- index: HTMLSpanElement - порядковый номер товара
- title: HTMLSpanElement - название товара
- price: HTMLSpanElement - цена товара
- deleteButton: HTMLButtonElement - кнопка удаления товара

Методы:
- render(data: {id: string, title: string, price: number}): HTMLElement - заполняет разметку и возвращает готовый элемент.

#### Класс PymentMethodView
Отображение окна с выбором метода оплаты и введением адреса доставки.
Конструктор класса принимает инстант брокера событий и (container: HTMLElement) для определения в нем нужных элементов.
На кнопку далее уснанавливается слушатель клика инициирующий событие ('goto:email') передавая способ оплаты и адрес.

В полях класса хранятся следующие данные:
- events: IEvents - экземпляр, реализующий интерфейс IEvents, используемый для управления событиями страницы.
- adress: string - хранит введенный адрес
- paymentMethod: TPaymentMethod - хранит выбранный метод оплаты

- adressInput: HTMLInputElement - поле ввода адреса доставки
- onlineButton: HTMLButtonElement - кнопка выбора оплаты онлайн
- cashButton: HTMLButtonElement - кнопка выбора оплаты при получении
- submitButton: HTMLButtonElement - кнопка далее

Методы:
- render(): HTMLElement - возвращает готовый элемент.

#### Класс EmailVeiw
Отображение окна для введения почты и телефона.
Конструктор класса принимает инстант брокера событий и (container: HTMLElement) для определения в нем нужных элементов.
На кнопку оплатить уснанавливается слушатель клика инициирующий событие ('submit:order') передавая почту и телефон.

В полях класса хранятся следующие данные:
- events: IEvents - экземпляр, реализующий интерфейс IEvents, используемый для управления событиями страницы.
- email: string - хранит почту
- phone: string - хранит телефон

- emailInput: HTMLInputElement - поле ввода почты
- phoneInput: HTMLInputElement - поле ввода телефона
- payButton: HTMLButtonElement - кнопка оплатить

Методы:
- render(): HTMLElement - возвращает готовый элемент.

#### Класс SuccessMessageView
Отображение сообщения об успешной оплате.
Конструктор класса принимает инстант брокера событий и (container: HTMLElement) для определения в нем нужных элементов.
На кнопку за новыми покупками уснанавливается слушатель клика инициирующий событие ('order:submited').

В полях класса хранятся следующие данные:
- events: IEvents - экземпляр, реализующий интерфейс IEvents, используемый для управления событиями страницы.
- totalPrice: HTMLParagraphElement - списанная сумма
- backToShopingButton: HTMLButtonElement - кнопка за новыми покупками

Методы:
- render(price: number): HTMLElement - возвращает готовый элемент.


### Презентер
Модели и отображение будут связываться с использованием событийно-ориентированного подхода.
Далее описан сценарий работы приложения и применяемые события:

- При загрузке сайта:
-Создаются экземпляры классов: LarekApi, EventEmitter, CardsData, BasketModel, OrderDetails, PageView, ModalView.
-С сервера запрашивается список товаров и сохраняется в модель CardsData.
-Создается массив элементов карточек товара (СatalogCardVeiw) и вставляется в список товаров внутри (PageView).

- Нажатие на карточку товара в каталоге (СatalogCardVeiw) вызывает событие 'product:selected' передавая данные товара. С использованием этих данных отрисовывается элемент предпросмотра товара (CardPreviewVeiw), вставляется в мадалку (ModalView), после чего, модалка отображается на экране.

- Нажатие на кнопку добавления в корзину вызывает событие 'product:add' передавая данные товара. Данные сохраняются в массиве товаров Модели корзины. Модальное окно закрывается.

- При вызове функций добавления товара, удаления товара и очистки корзины, вызывается событие 'basket:changed' передавая id соответствующего товара. Реакцией на это событие является: Соответствующие изменение в модели данных корзины (BasketModel), перерисовка отображения корзины (BasketView) и обнавление счетчика товаров в корзине на главной странице.

- Нажатие на корзину вызывает событие 'basket:open'. Используя данные и методы модели корзины отрисовывается элемент корзины (BasketView), отрисовываются элементы корзины (BasketItemView), вставляются в корзину, после чего, корзина вставляется в модалку и отображается на экране.

- Нажатие на кнопку удаления товара из корзины вызывает событие 'basket:changed' описанное выше.

- Нажатие на кнопку оформления заказа вызывает событие 'goto:payment'. В модель зказа (OrderDetails) сохраняется массив с айдишниками товаров и сумма заказа (эти данные берутся из модели корзины). Отрисовывается элемент выбора метода оплаты (PymentMethodView) и вставляется в модалку.

- Нажатие на кнопку далее вызывает событие 'goto:email' передавая способ оплаты и адрес. Эти данные сохраняются в модель зказа (OrderDetails). Отрисовывается элемент ввода почты и телефона (EmailVeiw) и вставляется в модалку.

- Нажатие на кнопку оплатить вызывает событие 'submit:order' передавая почту и телефон. Эти данные сохраняются в модель зказа (OrderDetails). После чего, заказ отравляется на сервер. Отрисовывается сообщения об успешной оплате (SuccessMessageView) и вставляется в модалку.

- Нажатие на кнопку за новыми покупками вызывает событие 'order:submited'. Корзина очищается. Модальное окно закрывается. Перерисовывается корзина. Обнавляется счетчик товаров в корзине на главной странице.